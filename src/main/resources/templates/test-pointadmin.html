<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layout/default_layout}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Charti</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap"
          rel="stylesheet">
    <style>
        body { font-family: 'Poppins', sans-serif; }
    </style>
</head>
<th:block layout:fragment="content">
    <head><title>포인트 지급</title></head>

    <div class="flex justify-center mt-6 space-x-6">
        <a href="/point" class="bg-blue-500 text-white p-3 rounded-lg w-[150px] text-center hover:bg-blue-600">
            포인트 조회
        </a>
        <a href="/admin/point" class="bg-blue-500 text-white p-3 rounded-lg w-[150px] text-center hover:bg-blue-600">
            포인트 지급
        </a>
    </div>
    <div class="mt-10 flex justify-center">

    <div class="mt-10">

    <h3 class="text-xl font-bold mb-3">포인트 지급/차감 테스트</h3>
    <label>회원 ID:
        <input type="number" id="targetMemberId" value="1" class="border rounded p-1">
    </label>
    <label class="ml-3">금액:
        <input type="number" id="amount" value="1000" class="border rounded p-1">
    </label>
    <label class="ml-3">설명:
        <input type="text" id="desc" value="관리자 지급" class="border rounded p-1 w-64">
    </label>
    <button onclick="changePoint()" class="ml-3 bg-green-500 text-white px-3 py-1 rounded hover:bg-green-600">실행</button>
    <p id="changeResult" class="mt-2 text-sm text-gray-700">-</p>
</div>
    </div>

<script>
    async function changePoint() {
        const targetId = document.getElementById('targetMemberId').value;
        const amount = document.getElementById('amount').value;
        const desc = document.getElementById('desc').value;

        const res = await fetch('/points/change', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                memberId: parseInt(targetId),
                amount: parseInt(amount),
                description: desc
            })
        });

        const resultText = document.getElementById('changeResult');
        if (res.ok) {
            resultText.innerText = `회원 ${targetId} 포인트 변경 완료!`;
            if (targetId === document.getElementById('memberId').value) {
                getPoint(); // 대상이 현재 조회 대상이면 자동 갱신
            }
        } else {
            const err = await res.text();
            resultText.innerText = `${err}`;
        }
    }
</script>
</th:block>
</html>
